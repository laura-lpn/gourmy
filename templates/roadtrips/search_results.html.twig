{% extends 'base.html.twig' %}

{% block title %}
	Résultats de la recherche
{% endblock %}

{% block body %}
	<h1 class="text-2xl font-bold mb-4">Résultats de la recherche</h1>

	{% for label, messages in app.flashes %}
		{% for message in messages %}
			<div class="alert alert-{{ label }}">
				{% autoescape false %}
					{{ message }}
				{% endautoescape %}
			</div>
		{% endfor %}
	{% endfor %}

	<!-- Affichage des résultats de chaque étape -->
	<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
		{% for result in results %}
			<div class="bg-white p-4 rounded shadow mb-4">
				<h2 class="text-xl font-semibold">{{ result.town }}</h2>

				{% if result.cuisine %}
					<p>
						<strong>Type(s) de cuisine :</strong>
						{% if result.cuisine is iterable %}
							{{ result.cuisine|join(', ') }}
						{% else %}
							{{ result.cuisine }}
						{% endif %}
					</p>
				{% endif %}

				<p>
					<strong>Nombre de repas :</strong>
					{{ result.meals }}</p>

				{% if result.restaurants is empty %}
					<p class="text-sm text-gray-500">Aucun restaurant trouvé.</p>
				{% else %}
					<ul class="list-disc ml-5 mt-2">
						{% for restaurant in result.restaurants %}
							<li>
								<strong>{{ restaurant.name }}</strong>
								{% if restaurant.types is not empty %}
									{% for type in restaurant.types %}
										<p>{{ type.name }}</p>
									{% endfor %}
								{% endif %}
							</li>
						{% endfor %}
					</ul>
				{% endif %}
			</div>
		{% endfor %}
	</div>

	<!-- Bouton pour ouvrir la modale -->
	<div class="text-center">
		<button type="button" onclick="document.getElementById('saveModal').showModal()" class="bg-green-600 text-white px-6 py-2 rounded shadow">
			Enregistrer ce roadtrip
		</button>
	</div>

	<!-- Modale d'enregistrement -->
	<dialog id="saveModal" class="rounded-lg p-6 max-w-md w-full border shadow-lg backdrop:bg-black/40">
		<form
			method="POST" action="{{ path('roadtrip_save') }}" class="space-y-4">
			<!-- Données exactes de la recherche, à sauvegarder -->
			<input type="hidden" name="stepsData" value='{{ stepsForSave|json_encode|e('html_attr') }}'>

			<div class="flex justify-between items-center">
				<h2 class="text-xl font-semibold">Enregistrer ce roadtrip</h2>
				<button type="button" onclick="document.getElementById('saveModal').close()" class="text-red-500 text-2xl leading-none">&times;
				</button>
			</div>

			<div>
				<label for="title" class="block font-semibold">Titre du roadtrip</label>
				<input type="text" id="title" name="title" required class="w-full border px-3 py-2 rounded">
			</div>

			<div>
				<label for="description" class="block font-semibold">Description</label>
				<textarea id="description" name="description" rows="3" required class="w-full border px-3 py-2 rounded"></textarea>
			</div>

			<div class="flex items-center">
				<input type="checkbox" id="isPublic" name="isPublic" class="mr-2">
				<label for="isPublic">Rendre ce roadtrip public</label>
			</div>

			<div class="text-right">
				<button type="submit" class="bg-blue text-white px-4 py-2 rounded">
					Enregistrer
				</button>
			</div>
		</form>
	</dialog>
{% endblock %}
