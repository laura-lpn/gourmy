{% extends 'base.html.twig' %}

{% block title %}Admin - Tableau de bord
{% endblock %}

{% block body %}
	<div
		class="mt-28 max-w-6xl w-11/12 mx-auto px-4 sm:px-6 lg:px-8">

		{# Titre principal #}
		<h1 class="my-h1 text-center mb-8 sm:mb-10">
			Tableau de bord
		</h1>

		{# Statistiques principales #}
		<div class="grid grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-8 sm:mb-10">
			<div class="bg-blue/5 rounded-xl p-5 sm:p-6 text-center border border-blue/10">
				<h2 class="text-blue text-2xl sm:text-3xl font-second font-medium">{{ restaurantsValidated }}</h2>
				<p class="text-xs sm:text-sm">Restaurants validés</p>
			</div>

			<div class="bg-orange/5 rounded-xl p-5 sm:p-6 text-center border border-orange/10">
				<h2 class="text-orange text-2xl sm:text-3xl font-second font-medium">{{ restaurantsPending }}</h2>
				<p class="text-xs sm:text-sm">Restaurants en attente</p>
				<a href="{{ path('app_admin_restaurants') }}" class="mt-3 inline-flex items-center text-orange text-xs sm:text-sm font-medium hover:text-orange/80">
					<i class="fa-solid fa-arrow-right mr-1"></i>
					Gérer
				</a>
			</div>

			<div class="bg-lime-50 rounded-xl p-5 sm:p-6 text-center border border-lime-100">
				<h2 class="text-lime-600 text-2xl sm:text-3xl font-second font-medium">{{ roadtripsPublic }}</h2>
				<p class="text-xs sm:text-sm">Roadtrips publics</p>
			</div>

			<div class="bg-violet-50 rounded-xl p-5 sm:p-6 text-center border border-violet-100">
				<h2 class="text-violet-600 text-2xl sm:text-3xl font-second font-medium">{{ users }}</h2>
				<p class="text-xs sm:text-sm">Utilisateurs</p>
			</div>

			<div class="bg-amber-50 rounded-xl p-5 sm:p-6 text-center border border-amber-100">
				<h2 class="text-amber-600 text-2xl sm:text-3xl font-second font-medium">{{ reviews }}</h2>
				<p class="text-xs sm:text-sm">Avis</p>
			</div>

			<div class="bg-rose-50 rounded-xl p-5 sm:p-6 text-center border border-rose-100">
				<h2 class="text-rose-600 text-2xl sm:text-3xl font-second font-medium">{{ badgesCount }}</h2>
				<p class="text-xs sm:text-sm">Badges</p>
				<a href="{{ path('app_admin_badges') }}" class="mt-3 inline-flex items-center text-rose-600 text-xs sm:text-sm font-medium hover:text-rose-600/80">
					<i class="fa-solid fa-arrow-right mr-1"></i>
					Gérer
				</a>
			</div>
		</div>

		{# Top 5 utilisateurs #}
		<section class="rounded-xl bg-blue/5 p-4 sm:p-6">
			<h2 class="text-xl sm:text-2xl font-second text-blue flex items-center gap-3 mb-4 sm:mb-6">
				<span class="h-1 w-8 bg-blue inline-block rounded"></span>
				Top 5 des utilisateurs les plus actifs
			</h2>

			{# Vue mobile : cartes #}
			<ul class="lg:hidden space-y-3">
				{% for user in topUsers %}
					<li class="bg-white border border-blue/10 rounded-xl p-3 flex items-center gap-3">
						{% if user.avatarName %}
							<img src="{{ vich_uploader_asset(user, 'avatarFile') }}" alt="Avatar de {{ user.username }}" class="w-10 h-10 rounded-full object-cover">
						{% else %}
							<img src="{{ asset('images/avatar-placeholder.png') }}" alt="Avatar par défaut" class="w-10 h-10 rounded-full object-cover">
						{% endif %}

						<div class="flex-1 min-w-0">
							<p class="font-second font-medium text-blue truncate">{{ user.username }}</p>
							<div class="mt-1 flex items-center gap-3 text-xs text-gray-600">
								<span class="whitespace-nowrap">
									<i class="fa-solid fa-star text-amber-500 mr-1"></i>
									{{ user.points }}
									pts
								</span>
								<span class="whitespace-nowrap">
									<i class="fa-solid fa-medal text-blue mr-1"></i>
									{{ user.badges|length }}
									badges
								</span>
							</div>
						</div>
					</li>
				{% else %}
					<li class="text-center text-gray-500 bg-white border border-blue/10 rounded-xl p-4">
						Aucun utilisateur actif trouvé.
					</li>
				{% endfor %}
			</ul>

			{# Vue desktop : tableau #}
			<div class="hidden lg:block overflow-x-auto rounded-xl border border-blue/10 bg-white">
				<table class="w-full min-w-[720px] border-collapse">
					<thead class="bg-blue/10 text-blue text-sm uppercase font-second sticky top-0 z-10">
						<tr>
							<th class="p-3 text-left w-1/2">Utilisateur</th>
							<th class="p-3 text-center w-1/4">Points</th>
							<th class="p-3 text-center w-1/4">Badges</th>
						</tr>
					</thead>
					<tbody>
						{% for user in topUsers %}
							<tr class="odd:bg-white even:bg-blue/5 hover:bg-blue/10 transition">
								<td class="p-3">
									<div class="flex items-center gap-3 min-w-0">
										{% if user.avatarName %}
											<img src="{{ vich_uploader_asset(user, 'avatarFile') }}" alt="Avatar de {{ user.username }}" class="w-8 h-8 rounded-full object-cover">
										{% else %}
											<img src="{{ asset('images/avatar-placeholder.png') }}" alt="Avatar par défaut" class="w-8 h-8 rounded-full object-cover">
										{% endif %}
										<span class="truncate block max-w-[280px]">{{ user.username }}</span>
									</div>
								</td>
								<td class="p-3 text-center whitespace-nowrap">{{ user.points }}</td>
								<td class="p-3 text-center whitespace-nowrap">{{ user.badges|length }}</td>
							</tr>
						{% else %}
							<tr>
								<td colspan="3" class="p-4 text-center text-gray-500">
									Aucun utilisateur actif trouvé
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</section>

	</div>
{% endblock %}