{% extends 'base.html.twig' %}

{% block title %}Profil
{% endblock %}

{% block body %}
	<div class="mt-28">
		{% for label, messages in app.flashes %}
			{% for message in messages %}
				<div class="w-3/5 mx-auto alert alert-{{ label }}">
					{% autoescape false %}
						{{ message }}
					{% endautoescape %}
				</div>
			{% endfor %}
		{% endfor %}
		<section class="w-3/4 mx-auto flex items-center gap-16 py-4">
			{% if user.avatarName %}
				<img src="{{ vich_uploader_asset(user, 'avatarFile') }}" alt="Avatar" class="w-64 rounded-full">
			{% else %}
				<img src="{{ asset('images/avatar-placeholder.png') }}" alt="Avatar par défaut" class="w-64 rounded-full">
			{% endif %}

			<div>
				<h1 class="font-second text-blue text-4xl font-medium">{{ user.firstName ~ ' ' ~ user.lastName }}</h1>
				<p class="text-orange font-medium text-lg">@{{ user.username|lower }}</p>
				<p class="text-sm mt-2">
					Classement général :
					<strong class="font-medium text-blue">{{ rank }}<sup>e</sup>
					</strong>
					sur
					{{ all_users_count }}
					utilisateurs
				</p>
				<div class="mt-4 flex gap-4">
					<button id="share-profile" type="button" class="btn-secondary flex items-center gap-2 text-sm" data-url="{{ app.request.scheme ~ '://' ~ app.request.host ~ path('app_user_show', { username: user.username|lower }) }}">
						<i class="fa-solid fa-share-nodes"></i>
						Partager mon profil
					</button>
					<p id="copy-feedback" class="text-green-600 text-sm mt-2 hidden">Lien copié !</p>
				</div>
			</div>

			<div x-data="{ open: false }" class="relative ml-auto">
				<button title="Paramètres" @click="open = !open" class="text-blue text-2xl bg-blue/5 py-2 px-4 rounded-full">
					<i class="fa-solid fa-gear"></i>
				</button>

				<div x-show="open" @click.outside="open = false" class="absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded shadow-lg z-10">
					<a href="{{path('app_logout')}}" class="block px-4 py-2 hover:bg-gray-100 text-sm">Déconnexion</a>
					<a href="{{ path('app_user_edit') }}" class="block px-4 py-2 hover:bg-gray-100 text-sm">Éditer</a>
					<button type="button" class="block w-full text-left px-4 py-2 hover:bg-red-100 text-sm text-red-600" onclick="confirmDeletion()">
						Supprimer
					</button>
					<script type="module" src="{{ asset('webcomponents/ModalConfirm.js') }}"></script>
					<modal-confirm id="delete-confirm"></modal-confirm>
				</div>
			</div>

		</section>

		<script type="module" src="{{ asset('webcomponents/TabView.js') }}"></script>

		<section class="w-3/4 mx-auto mt-8">
			<tab-view>
				<tab-item title="Photos">
					{{ include("user/profile/_photos.html.twig", { photos: photos })|raw }}
				</tab-item>

				<tab-item title="Roadtrips">
					{{ include("user/profile/_roadtrips.html.twig", { isPublic: false })|raw }}
				</tab-item>

				<tab-item title="Avis">
					<review-list user-id="{{ app.user ? app.user.id : ' ' }}" editable="true"></review-list>
				</tab-item>

				<tab-item title="Favoris">
					<user-favorites></user-favorites>
				</tab-item>

				<tab-item title="Badges">
					{{ include("user/profile/_badges.html.twig")|raw }}
				</tab-item>

				<tab-item title="Carte">
					{{ include("user/profile/_map.html.twig")|raw }}
				</tab-item>
			</tab-view>
		</section>
	</div>

	<script>
		function confirmDeletion() {
const modal = document.getElementById('delete-confirm');
modal.show('Voulez-vous vraiment supprimer votre compte ?', () => {
window.location.href = "{{ path('app_user_delete') }}";
});
}
document.getElementById('share-profile') ?. addEventListener('click', () => {
const url = document.getElementById('share-profile').dataset.url;
navigator.clipboard.writeText(url).then(() => {
const feedback = document.getElementById('copy-feedback');
feedback.classList.remove('hidden');
setTimeout(() => feedback.classList.add('hidden'), 2000);
});
});
	</script>
{% endblock %}
